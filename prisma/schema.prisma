generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ‚úÖ GARDER ces models (donn√©es de la plateforme)
model Formation {
  id            Int        @id @default(autoincrement())
  titre         String
  slug          String      @unique
  description   String
  programme     String?
  duree         String?
  tarifPres     Int?
  tarifOnline   Int?
  mensualite    Int?
  nombreMois    Int?
  imageUrl      String?
  brochureUrl   String?
  categorie     String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Message {
  id          Int       @id @default(autoincrement())
  prenom      String
  nom         String
  email       String
  telephone   String?
  sujet       String
  message     String
  lu          Boolean   @default(false)
  createdAt   DateTime  @default(now())
}

model Inscription {
  id                  Int        @id @default(autoincrement())
  nom                 String
  prenom              String
  email               String     @unique
  telephone           String
  formation           String
  submissions         Submission[]

  montantInscription  Int        @default(30000)
  mensualite          Int?
  nombreMois          Int?

  cohorte             Int?
  estActif            Boolean    @default(true)
  dateFinFormation    DateTime?

  status              Status     @default(PENDING)
  code                String?    @unique
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  paiements           Paiement[]
}

model Paiement {
  id              Int             @id @default(autoincrement())
  inscriptionId   Int
  inscription     Inscription     @relation(fields: [inscriptionId], references: [id], onDelete: Cascade)
  mois            Int
  montant         Int
  status          StatusPaiement  @default(EN_ATTENTE)
  dateValidation  DateTime?
  recuUrl         String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}

model Evenement {
  id          Int        @id @default(autoincrement())
  titre       String
  slug        String      @unique
  description String
  date        DateTime
  imageUrl    String?
  gallery     Galerie[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model Galerie {
  id          Int        @id @default(autoincrement())
  url         String
  evenementId Int
  evenement   Evenement  @relation(fields: [evenementId], references: [id])
}

model Article {
  id          Int        @id @default(autoincrement())
  titre       String
  slug        String      @unique
  contenu     String
  imageUrl    String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model Service {
  id          Int       @id @default(autoincrement())
  titre       String
  description String
  imageUrl    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model User {
  id        Int      @id @default(autoincrement())
  nom       String
  email     String   @unique
  password  String
  role      Role     @default(USER)
  formation String?
  cohorte   Int?
  createdAt DateTime @default(now())
}

// üÜï MODIFI√â : Assignment avec partId
model Assignment {
  id          Int          @id @default(autoincrement())
  partId      String       // üÜï "part-1-1-1" (ID de la partie depuis JSON)
  lessonId    String       // ‚úÖ "lesson-1-1" (pour r√©f√©rence)
  moduleId    String       // ‚úÖ "module-1" (pour r√©f√©rence)
  formation   String       // ‚úÖ "dev-web"
  instruction String       // Titre de la partie
  submissions Submission[]
  createdAt   DateTime     @default(now())

  @@unique([partId, formation]) // üÜï Une partie par formation
  @@index([lessonId, moduleId])
}

// ‚úÖ Submission : TD soumis par l'√©tudiant (INCHANG√â)
model Submission {
  id            Int              @id @default(autoincrement())
  assignmentId  Int
  assignment    Assignment       @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  inscriptionId Int
  inscription   Inscription      @relation(fields: [inscriptionId], references: [id], onDelete: Cascade)
  link          String
  status        SubmissionStatus @default(PENDING)
  feedback      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([inscriptionId, assignmentId]) // üÜï Un √©tudiant = une soumission par assignment (donc par partie)
  @@index([inscriptionId])
  @@index([assignmentId])
  @@index([status])
}

enum ContentStatus {
  DRAFT
  PENDING
  PUBLISHED
  ARCHIVED
}

enum SubmissionStatus {
  PENDING
  APPROVED
  REJECTED
}

enum Status {
  PENDING
  VALIDATED
}

enum StatusPaiement {
  EN_ATTENTE
  VALIDE
  REJETE
}

enum Role {
  ADMIN
  USER
  COACH
}

// üìù APR√àS AVOIR MODIFI√â CE FICHIER :
// 1. npx prisma migrate dev --name add_part_id_to_assignments
// 2. npx prisma generate